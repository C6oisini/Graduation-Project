è¿™æ˜¯ä¸ºä½ å‡†å¤‡çš„**æ ¸å¿ƒç®—æ³•è®¾è®¡æ–‡æ¡£**ã€‚ä½ å¯ä»¥å°†å…¶ç›´æ¥ä½œä¸ºè®ºæ–‡çš„**â€œç¬¬ä¸‰ç« ï¼šæ–¹æ³•è®ºâ€**ä¸­çš„æ ¸å¿ƒå°èŠ‚ï¼ˆå¦‚ 3.2 å’Œ 3.3ï¼‰ã€‚

è¿™ä»½è®¾è®¡æ–‡æ¡£ä¸ä»…åŒ…å«äº†ä¸¥è°¨çš„æ•°å­¦å®šä¹‰ï¼Œè¿˜æä¾›äº†é’ˆå¯¹ Qwen-VL çš„å…·ä½“å·¥ç¨‹å®ç°é€»è¾‘ï¼Œæ¶µç›–äº†**åŒé€šé“æ¶æ„**å’Œ**éå¯¹ç§°é¢„ç®—åˆ†é…**ã€‚

------

# ç¬¬ä¸‰ç«  è¯­ä¹‰æ„ŸçŸ¥åº¦é‡éšç§æœºåˆ¶è®¾è®¡ (Methodology)

## 3.2 è¯­ä¹‰æµå½¢ä¸åº¦é‡ç©ºé—´å®šä¹‰

**(Semantic Manifold and Metric Space Definition)**

ä¸ºäº†å…‹æœæ¬§æ°ç©ºé—´ä¸‹åŠ æ€§å™ªå£°ç ´å Transformer è¯­ä¹‰ç»“æ„çš„ç¼ºé™·ï¼Œæœ¬æ–‡å°† Qwen-VL çš„ç‰¹å¾å‘é‡å»ºæ¨¡ä¸ºé»æ›¼æµå½¢ï¼ˆRiemannian Manifoldï¼‰ä¸Šçš„ç‚¹ã€‚

### 3.2.1 å•ä½è¶…çƒé¢å‡è®¾

åœ¨å¤§æ¨¡å‹ä¸­ï¼ŒLayerNorm å±‚å°†ç‰¹å¾å‘é‡çš„ç»Ÿè®¡åˆ†å¸ƒè¿›è¡Œäº†æ ‡å‡†åŒ–ï¼Œè€Œ Attention æœºåˆ¶é€šè¿‡ç‚¹ç§¯ï¼ˆDot-Productï¼‰è¡¡é‡ç›¸å…³æ€§ï¼Œå…¶æœ¬è´¨æ˜¯è®¡ç®—å‘é‡å¤¹è§’çš„ä½™å¼¦å€¼ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å‡è®¾æœ‰æ•ˆçš„è¯­ä¹‰ç‰¹å¾åˆ†å¸ƒåœ¨ä¸€ä¸ª $d-1$ ç»´çš„å•ä½è¶…çƒé¢ $\mathbb{S}^{d-1}$ ä¸Šï¼Œå…¶ä¸­ $d$ ä¸º Embedding çš„ç»´åº¦ï¼ˆå¯¹äº Qwen-VL-8Bï¼Œé€šå¸¸ $d=4096$ï¼‰ã€‚

å¯¹äºä»»æ„è¾“å…¥å‘é‡ $\mathbf{x} \in \mathbb{R}^d$ï¼Œæˆ‘ä»¬å°†å…¶åˆ†è§£ä¸º**æ¨¡é•¿ï¼ˆMagnitudeï¼‰** $r$ å’Œ**æ–¹å‘ï¼ˆDirectionï¼‰** $\mathbf{\mu}$ï¼š

$$r = \|\mathbf{x}\|_2, \quad \mathbf{\mu} = \frac{\mathbf{x}}{\|\mathbf{x}\|_2} \in \mathbb{S}^{d-1}$$

å…¶ä¸­ï¼Œæ¨¡é•¿ $r$ æºå¸¦ä¿¡å·å¼ºåº¦ä¿¡æ¯ï¼Œæ–¹å‘ $\mathbf{\mu}$ æºå¸¦æ ¸å¿ƒè¯­ä¹‰ä¿¡æ¯ã€‚æœ¬æ–‡çš„éšç§æ‰°åŠ¨ä¸»è¦ä½œç”¨äº $\mathbf{\mu}$ã€‚

### 3.2.2 von Mises-Fisher åˆ†å¸ƒæ¨¡å‹

ä¸ºäº†å®ç°è¯­ä¹‰æ„ŸçŸ¥çš„åº¦é‡éšç§ï¼Œæœ¬æ–‡å¼•å…¥ **von Mises-Fisher (vMF)** åˆ†å¸ƒä½œä¸ºæ‰°åŠ¨å™ªå£°çš„æ¦‚ç‡æ¨¡å‹ã€‚vMF åˆ†å¸ƒæ˜¯é«˜æ–¯åˆ†å¸ƒåœ¨è¶…çƒé¢ä¸Šçš„æ¨å¹¿ï¼Œå…¶æ¦‚ç‡å¯†åº¦å‡½æ•°ï¼ˆPDFï¼‰å®šä¹‰ä¸ºï¼š

$$f_{vMF}(\mathbf{z}; \mathbf{\mu}, \kappa) = C_d(\kappa) \exp(\kappa \cdot \mathbf{\mu}^T \mathbf{z})$$

å…¶ä¸­ï¼š

- $\mathbf{\mu}$ ä¸ºå‡å€¼æ–¹å‘ï¼ˆå³åŸå§‹è¯­ä¹‰æ–¹å‘ï¼‰ã€‚
- $\kappa \ge 0$ ä¸º**é›†ä¸­åº¦å‚æ•°ï¼ˆConcentration Parameterï¼‰**ï¼Œæ§åˆ¶åˆ†å¸ƒçš„ç¦»æ•£ç¨‹åº¦ã€‚$\kappa$ è¶Šå¤§ï¼Œé‡‡æ ·ç‚¹è¶Šèšé›†åœ¨ $\mathbf{\mu}$ é™„è¿‘ï¼ˆéšç§ä¿æŠ¤å¼±ï¼Œæ•ˆç”¨é«˜ï¼‰ï¼›$\kappa$ è¶Šå°ï¼Œåˆ†å¸ƒè¶Šå‡åŒ€ï¼ˆéšç§ä¿æŠ¤å¼ºï¼Œæ•ˆç”¨ä½ï¼‰ã€‚
- $C_d(\kappa)$ ä¸ºå½’ä¸€åŒ–å¸¸æ•°ã€‚

------

## 3.3 è¯­ä¹‰æ„ŸçŸ¥æ‰°åŠ¨ç®—æ³•è®¾è®¡

**(Semantic-Aware Perturbation Algorithm Design)**

åŸºäºä¸Šè¿°ç†è®ºï¼Œæœ¬æ–‡è®¾è®¡äº†**â€œæ­£äº¤åˆ‡å¹³é¢æŠ•å½±æ‰°åŠ¨ç®—æ³•â€**ã€‚è€ƒè™‘åˆ°åœ¨é«˜ç»´ç©ºé—´ç›´æ¥ä» vMF é‡‡æ ·è®¡ç®—å¤æ‚åº¦è¾ƒé«˜ï¼ˆæ¶‰åŠè´å¡å°”å‡½æ•°ï¼‰ï¼Œæˆ‘ä»¬é‡‡ç”¨ä¸€ç§é«˜æ•ˆçš„å‡ ä½•è¿‘ä¼¼æ–¹æ³•æ¥å®ç°ã€‚

### 3.3.1 ç®—æ³•æµç¨‹

è¯¥ç®—æ³•çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šåœ¨ä»¥åŸå§‹å‘é‡ $\mathbf{\mu}$ ä¸ºæ³•å‘é‡çš„åˆ‡å¹³é¢ä¸Šç”Ÿæˆé«˜æ–¯å™ªå£°ï¼Œå°†å…¶ç¼©æ”¾åå åŠ å›åŸå§‹å‘é‡ï¼Œå†é‡æ–°æŠ•å½±å›è¶…çƒé¢ã€‚

**ç®—æ³• 1ï¼šåŸºäºå‡ ä½•æŠ•å½±çš„è¯­ä¹‰æ„ŸçŸ¥æ‰°åŠ¨ (Geometric Projection Perturbation)**

- **è¾“å…¥ï¼š**
  - åŸå§‹ Embedding å‘é‡ $\mathbf{x} \in \mathbb{R}^{B \times L \times d}$
  - éšç§é¢„ç®— $\epsilon$ (Privacy Budget)
  - æ¨¡æ€ç±»å‹ $Type \in \{Image, Text\}$
- **è¾“å‡ºï¼š** æ‰°åŠ¨åçš„å‘é‡ $\mathbf{y}$

**æ­¥éª¤è¯¦è§£ï¼š**

1. **åˆ†è§£ä¸å½’ä¸€åŒ–ï¼š**

   è®¡ç®—æ¨¡é•¿ $r$ ä¸å•ä½æ–¹å‘ $\mathbf{\mu}$ã€‚

   $$\mathbf{\mu} = \mathbf{x} / \|\mathbf{x}\|_2$$

2. **æ­£äº¤å™ªå£°ç”Ÿæˆ (Orthogonal Noise Generation)ï¼š**

   ç”Ÿæˆæœä»æ ‡å‡†æ­£æ€åˆ†å¸ƒçš„éšæœºå™ªå£° $\mathbf{n} \sim \mathcal{N}(0, \mathbf{I}_d)$ã€‚ä¸ºäº†ç¡®ä¿ä»…ä»…æ”¹å˜æ–¹å‘è€Œä¸æ”¹å˜èƒ½é‡ï¼Œæˆ‘ä»¬éœ€è¦å°†å™ªå£°æŠ•å½±åˆ°ä¸ $\mathbf{\mu}$ å‚ç›´çš„åˆ‡å¹³é¢ä¸Šï¼Œå¾—åˆ°æ­£äº¤å™ªå£° $\mathbf{n}_{\perp}$ï¼š

   $$\mathbf{n}_{\perp} = \mathbf{n} - (\mathbf{n} \cdot \mathbf{\mu}) \cdot \mathbf{\mu}$$

   $$\mathbf{n}_{\perp} \leftarrow \frac{\mathbf{n}_{\perp}}{\|\mathbf{n}_{\perp}\|_2} \quad (\text{å½’ä¸€åŒ–})$$

3. **åŠ¨æ€å°ºåº¦ç¼©æ”¾ (Dynamic Scaling)ï¼š**

   æ ¹æ®éšç§é¢„ç®— $\epsilon$ è®¡ç®—æ‰°åŠ¨å¹…åº¦ $\lambda$ã€‚å¯¹äº $d$ ç»´ç©ºé—´ä¸‹çš„ $d$-privacyï¼Œå°ºåº¦å‚æ•°ä¸ $\epsilon$ è¿‘ä¼¼æˆåæ¯”å…³ç³»ï¼š

   $$\lambda = \frac{\beta}{\epsilon}$$

   å…¶ä¸­ $\beta$ æ˜¯è°ƒèŠ‚ç³»æ•°ï¼ˆè¶…å‚æ•°ï¼‰ã€‚

4. **æ–¹å‘åè½¬ (Directional Deviation)ï¼š**

   å°†æ­£äº¤å™ªå£°å åŠ è‡³åŸå§‹æ–¹å‘ï¼š

   $$\mathbf{z} = \mathbf{\mu} + \lambda \cdot \mathbf{n}_{\perp}$$

   *å›¾æ³¨ï¼šåŸå§‹å‘é‡ $\mu$ åŠ ä¸Šåˆ‡å‘å™ªå£° $\lambda n_{\perp}$ åå¾—åˆ°ä¸­é—´å‘é‡ $z$ï¼Œå†å½’ä¸€åŒ–å¾—åˆ°æœ€ç»ˆå‘é‡ $\mu'$ã€‚*

5. **é‡æŠ•å½±ä¸æ¢å¤ (Reprojection & Restoration)ï¼š**

   å°† $\mathbf{z}$ é‡æ–°æŠ•å½±å›å•ä½è¶…çƒé¢å¾—åˆ°æ‰°åŠ¨åçš„æ–¹å‘ $\mathbf{\mu}'$ï¼Œå¹¶æ¢å¤åŸå§‹æ¨¡é•¿ $r$ï¼š

   $$\mathbf{\mu}' = \frac{\mathbf{z}}{\|\mathbf{z}\|_2}, \quad \mathbf{y} = r \cdot \mathbf{\mu}'$$

------

## 3.4 åŒé€šé“éå¯¹ç§°é¢„ç®—åˆ†é…ç­–ç•¥

**(Dual-Channel Asymmetric Budget Allocation Strategy)**

é’ˆå¯¹ Qwen-VL å¤šæ¨¡æ€è¾“å…¥çš„å¼‚æ„æ€§ï¼Œå•çº¯åº”ç”¨ä¸Šè¿°ç®—æ³•ä¼šå¯¼è‡´â€œæ–‡æœ¬å´©å¡Œâ€æˆ–â€œå›¾åƒä¿æŠ¤ä¸è¶³â€ã€‚å› æ­¤ï¼Œæœ¬æ–‡è®¾è®¡äº†åŒé€šé“éå¯¹ç§°æ§åˆ¶æœºåˆ¶ã€‚

### 3.4.1 é¢„ç®—åˆ†é…å‡½æ•°

è®¾å®šç³»ç»Ÿæ€»éšç§é¢„ç®—ä¸º $\epsilon_{sys}$ã€‚æˆ‘ä»¬å®šä¹‰**éå¯¹ç§°åˆ†é…å› å­ (Asymmetry Factor)** $\alpha$ (é€šå¸¸ $\alpha > 1$)ï¼Œä½¿å¾—ï¼š

- **è§†è§‰é€šé“é¢„ç®— (Visual Budget):** $\epsilon_{vis} = \epsilon_{sys}$
- **æ–‡æœ¬é€šé“é¢„ç®— (Text Budget):** $\epsilon_{txt} = \alpha \cdot \epsilon_{sys}$

$$\epsilon(\text{modality}) = \begin{cases} \epsilon_{sys}, & \text{if modality is Visual} \\ \alpha \cdot \epsilon_{sys}, & \text{if modality is Text} \end{cases}$$

- **è®¾è®¡ç†ç”±ï¼š** å›¾åƒ Embeddings å…·æœ‰é«˜å†—ä½™æ€§ï¼Œè¾ƒå°çš„ $\epsilon$ ï¼ˆå¼ºå™ªå£°ï¼‰ä»…æ¨¡ç³Šç»†èŠ‚ï¼›æ–‡æœ¬ Embeddings å¤„äºç¦»æ•£æµå½¢ï¼Œéœ€è¦è¾ƒå¤§çš„ $\epsilon$ ï¼ˆå¼±å™ªå£°ï¼‰æ¥ä¿è¯ Token ä¸å‘ç”Ÿè¯­ä¹‰æ¼‚ç§»ã€‚

### 3.4.2 æ–‡æœ¬æ•æ„ŸåŒºæ©ç  (Text Sensitivity Masking)

ä¸ºäº†é˜²æ­¢ Qwen-VL çš„æŒ‡ä»¤éµå¾ªèƒ½åŠ›ä¸§å¤±ï¼Œå¿…é¡»å»ºç«‹**â€œå…ç–«åŒºâ€**ã€‚æˆ‘ä»¬åœ¨æ–‡æœ¬é€šé“å¼•å…¥æ©ç çŸ©é˜µ $\mathbf{M} \in \{0, 1\}^{L}$ï¼š

$$M_i = 
\begin{cases} 
0, & \text{if token}_i \in \{ \text{System Prompt}, \text{Instructions}, \texttt{<|im\_start|>} \dots \} \\
1, & \text{if token}_i \in \{ \text{User Content} \}
\end{cases}$$

æœ€ç»ˆçš„æ–‡æœ¬æ‰°åŠ¨å…¬å¼ä¿®æ­£ä¸ºï¼š

$$\mathbf{y}_{text} = \mathbf{M} \odot \mathbf{y}_{perturbed} + (1 - \mathbf{M}) \odot \mathbf{x}_{original}$$

å³ï¼šåªæ‰°åŠ¨ç”¨æˆ·è¾“å…¥çš„å†…å®¹ï¼Œä¿ç•™ç³»ç»ŸæŒ‡ä»¤çš„åŸæ ·ã€‚

------

## 3.5 éƒ¨ç½²æ¶æ„ä¸å®ç° (Deployment & Implementation)

### 3.5.1 å³æ’å³ç”¨ Hook è®¾è®¡

ä¸ºäº†åœ¨ä¸ä¿®æ”¹ Qwen-VL æºç çš„æƒ…å†µä¸‹å®ç°ä¸Šè¿°ç®—æ³•ï¼Œæœ¬æ–‡åˆ©ç”¨ PyTorch çš„ `register_forward_hook` æœºåˆ¶å®ç°æ‹¦æˆªä¸æ³¨å…¥ã€‚

- **Hook ç‚¹ A (Visual):** æŒ‚è½½äº Vision Transformer çš„è¾“å‡ºå±‚ (`model.visual`)ã€‚åœ¨æ­¤å¤„æ‹¦æˆªçš„å¼ é‡ç»´åº¦ä¸º `[B, N_patches, D]`ã€‚
- **Hook ç‚¹ B (Text):** æŒ‚è½½äº LLM çš„ Embedding å±‚ (`model.model.embed_tokens`)ã€‚åœ¨æ­¤å¤„æ‹¦æˆªçš„å¼ é‡ç»´åº¦ä¸º `[B, Seq_Len, D]`ã€‚

### 3.5.2 æ‹†åˆ†æ¨ç†æ•°æ®æµ (Split Inference Data Flow)

1. **ç«¯ä¾§ (Client):**
   - è¾“å…¥ $\xrightarrow{Encoder}$ åŸå§‹ Embeddings $\mathbf{x}$
   - $\mathbf{x} \xrightarrow{Algorithm 1}$ éšç§ Embeddings $\mathbf{y}$
   - å‘é€ $\mathbf{y}$ è‡³äº‘ç«¯ã€‚
2. **äº‘ç«¯ (Server):**
   - æ¥æ”¶ $\mathbf{y}$
   - $\mathbf{y} \xrightarrow{LLM}$ ç”Ÿæˆæ–‡æœ¬ç»“æœã€‚

------

### ğŸ’¡ å¦‚ä½•åœ¨è®ºæ–‡ä¸­è§£é‡Šè¿™ä¸ªç®—æ³•çš„â€œé«˜çº§æ„Ÿâ€ï¼Ÿ

åœ¨æ’°å†™è¿™éƒ¨åˆ†æ—¶ï¼Œä½ å¯ä»¥å¼ºè°ƒä»¥ä¸‹å‡ ç‚¹æ•°å­¦æ€§è´¨ï¼Œè®©ç®—æ³•çœ‹èµ·æ¥ä¸ä»…æ˜¯å·¥ç¨‹å®ç°ï¼Œæ›´æœ‰ç†è®ºæ·±åº¦ï¼š

1. **å„å‘å¼‚æ€§ (Anisotropy):** å¼ºè°ƒä½ çš„å™ªå£°ä¸æ˜¯çƒå½¢å¯¹ç§°çš„ï¼Œè€Œæ˜¯æ²¿ç€åˆ‡å¹³é¢åˆ†å¸ƒçš„ï¼Œè¿™å°Šé‡äº†æµå½¢çš„å±€éƒ¨å‡ ä½•ç»“æ„ã€‚
2. **èƒ½é‡å®ˆæ’ (Energy Preservation):** å¼ºè°ƒæ­¥éª¤ 5 ä¸­çš„ $r \cdot \mathbf{\mu}'$ æ“ä½œã€‚ä¿æŒæ¨¡é•¿ä¸å˜æ„å‘³ç€ä¿æŒäº†ç‰¹å¾çš„**æ˜¾è‘—æ€§ï¼ˆSaliencyï¼‰**ï¼Œè¿™å¯¹äº Attention æœºåˆ¶è‡³å…³é‡è¦ï¼Œå› ä¸º Attention çš„ Softmax éå¸¸ä¾èµ–å‘é‡çš„ç‚¹ç§¯å¤§å°ã€‚
3. **å¯è°ƒæ€§ (Tunability):** å¼ºè°ƒå‚æ•° $\epsilon$ å’Œ $\alpha$ æä¾›äº†ä¸€ä¸ªè¿ç»­çš„æ»‘å—ï¼Œå¯ä»¥åœ¨â€œå®Œå…¨éšç§â€å’Œâ€œå®Œå…¨æ•ˆç”¨â€ä¹‹é—´å¹³æ»‘è¿‡æ¸¡ã€‚